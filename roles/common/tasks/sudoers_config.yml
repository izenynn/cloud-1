---
- name: "Configure sudoers to read files from /etc/sudoers.d"
  tags:
    - user
    - sudoers
  lineinfile:
    path: /etc/sudoers
    regexp: '^#includedir /etc/sudoers.d'
    line: 'includedir /etc/sudoers.d'
    validate: 'visudo -cf %s'
  become: true

- name: "Configure general sudo group in sudoers"
  tags:
    - user
    - sudoers
  copy:
    dest: "/etc/sudoers.d/99-group-sudo"
    content: |
      # Custom sudoers file configuration
      # Explicitely reset existing configuration for the sudo group
      %sudo ALL=(ALL) ALL
      Defaults passwd_tries=3
      Defaults logfile=/var/log/sudo
      Defaults badpass_message="Unauthorized attempt has been logged."
      # Additional custom configuration must be below this line
    validate: 'visudo -cf %s'
    owner: root
    group: root
    mode: 0440
